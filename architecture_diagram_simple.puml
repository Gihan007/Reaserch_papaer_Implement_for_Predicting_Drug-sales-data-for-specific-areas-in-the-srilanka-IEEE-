@startuml PharmaPredictAI Enhanced System Architecture

skinparam backgroundColor #FFFFFF
skinparam defaultFontSize 10
skinparam shadowing false
skinparam ArrowColor #455A64

title PharmaPredictAI - Complete System Architecture (2025)

' Enhanced Data Layer
package "DATA INGESTION LAYER" #E3F2FD {
  [Pharmaceutical Sales\n8 Drug Categories\nC1-C8 (342K Records)] as DATA
  [Data Preprocessing\nLag Features (5 periods)\nNormalization\nMissing Value Handling] as PREP
  [Feature Engineering\nTemporal Features\nStatistical Aggregates] as FEAT
}

' Enhanced Model Training Layer
package "MODEL TRAINING PIPELINE" #FFF3E0 {
  [Classical ML\nSARIMAX\nXGBoost\nLightGBM\nProphet] as ML
  [Deep Learning\nLSTM (2 layers)\nGRU (2 layers)\nN-BEATS] as DL
  [Transformers\nVanilla Transformer\nInformer\nTemporal Fusion] as TF
  [Hyperparameter\nOptimization\nOptuna] as HPO
}

' Enhanced Advanced AI
package "ADVANCED AI SYSTEMS" #E8F5E9 {
  [Meta-Learning\nMAML Algorithm\nFew-Shot Learning\nTask Adaptation] as META
  [Neural Architecture\nSearch (NAS)\nGenetic Algorithm\nAuto-Design] as NAS
  [Federated Learning\n5 Client Nodes\nFedAvg Algorithm\nIID/Non-IID] as FED
  [Causal Inference\nPCMCI Discovery\nDoWhy Framework\nCounterfactuals] as CAUSAL
}

' NEW: Explainability Layer
package "EXPLAINABILITY & TRUST" #F3E5F5 {
  [SHAP Analysis\nFeature Importance\nWaterfall Plots\nSummary Charts] as SHAP
  [LLM Explanations\nLlama 3.1 8B\nPharmaceutical Context\nClinical Insights] as LLM
  [Uncertainty\nQuantification\nConfidence Intervals] as UNCERT
}

' Enhanced Prediction Engine
package "PREDICTION ENGINE" #FCE4EC {
  [Single Model\nPrediction\nDirect Inference] as SINGLE
  [Ensemble Learning\nWeighted Average\nStacking] as ENS
  [Multi-step Ahead\nForecast\n1-4 Weeks] as MULTI
  [Visualization\nInteractive Charts\nMatplotlib/Plotly] as VIZ
}

' Enhanced API Layer
package "FLASK REST API" #E1F5FE {
  [Forecast API\n/api/forecast\nPOST JSON] as API_FORE
  [Explainability API\n/api/explainability\n/api/explain] as API_EXPLAIN
  [Advanced AI APIs\n/api/meta\n/api/nas\n/api/federated] as API_ADV
  [Monitoring API\nHealth Checks\nMetrics] as API_MON
}

' Enhanced Frontend
package "WEB INTERFACE (RESPONSIVE)" #F3E5F5 {
  [Dashboard\n6 Metric Cards\nReal-time Stats] as DASH
  [Forecasting Page\n8 Model Selection\nInteractive UI] as FORECAST
  [Explainability UI\nSHAP Visualizations\nLLM Insights] as EXPLAIN_UI
  [Advanced Analytics\nNAS, Federated, Causal\nComparative Analysis] as ADV
  [Meta-Learning UI\nTask Adaptation\nFew-Shot Demo] as META_UI
}

' Enhanced Outputs
package "OUTPUTS & STORAGE" #FFF9C4 {
  [Predictions\nForecast Values\nConfidence Bounds\nPlots] as OUT
  [Model Artifacts\n.pth (PyTorch)\n.pkl (Pickle)\n.txt (LightGBM)] as FILES
  [Analysis Reports\nJSON Results\nPerformance Metrics\nSHAP Values] as REPORTS
  [Deployment\nNgrok Tunnel\nRender.com\nPublic URL] as DEPLOY
}

' NEW: External Services
cloud "EXTERNAL SERVICES" #E8EAF6 {
  [HuggingFace\nLlama 3.1 Models\nTransformers] as HF
  [Ngrok\nPublic Tunneling\nURL Sharing] as NGROK
  [Medical APIs\nWHO Guidelines\nDrug Information] as MED
}

' Data Flow Connections
DATA --> PREP
PREP --> FEAT
FEAT --> ML
FEAT --> DL
FEAT --> TF

ML --> HPO
DL --> HPO
TF --> HPO

HPO --> SINGLE
ML --> SINGLE
DL --> SINGLE
TF --> SINGLE

ML --> ENS
DL --> ENS
TF --> ENS

ML --> MULTI
ENS --> MULTI

ML --> META
DL --> META
TF --> META

ML --> NAS
DL --> NAS

ML --> FED
DL --> FED

FEAT --> CAUSAL
ML --> CAUSAL
DL --> CAUSAL

' NEW: Explainability Connections
SINGLE --> SHAP
ENS --> SHAP
ML --> SHAP
SINGLE --> LLM
ENS --> LLM

SINGLE --> UNCERT
ENS --> UNCERT

' Visualization Connections
SINGLE --> VIZ
ENS --> VIZ
MULTI --> VIZ
META --> VIZ
NAS --> VIZ
FED --> VIZ
CAUSAL --> VIZ
SHAP --> VIZ
LLM --> VIZ
UNCERT --> VIZ

' API Connections
VIZ --> API_FORE
SHAP --> API_EXPLAIN
LLM --> API_EXPLAIN
META --> API_ADV
NAS --> API_ADV
FED --> API_ADV
CAUSAL --> API_ADV

' Frontend Connections
API_FORE --> DASH
API_FORE --> FORECAST
API_EXPLAIN --> EXPLAIN_UI
API_ADV --> ADV
API_ADV --> META_UI
API_MON --> DASH

' Output Connections
DASH --> OUT
FORECAST --> OUT
EXPLAIN_UI --> OUT
ADV --> OUT
META_UI --> OUT

SINGLE --> FILES
ENS --> FILES
META --> FILES
NAS --> FILES
FED --> FILES

SHAP --> REPORTS
META --> REPORTS
NAS --> REPORTS
FED --> REPORTS
CAUSAL --> REPORTS

OUT --> DEPLOY
FILES --> DEPLOY

' External Service Connections
LLM ..> HF : "Model Download"
DEPLOY ..> NGROK : "Tunneling"
LLM ..> MED : "Context"

' Enhanced Notes
note right of DATA
  **Pharmaceutical Data**
  ‚Ä¢ C1: M01AB (Anti-inflammatory)
  ‚Ä¢ C2: M01AE (Propionic Acid)
  ‚Ä¢ C3: N02BA (Salicylic Acid)
  ‚Ä¢ C4: N02BE (Pyrazolones)
  ‚Ä¢ C5: N05B (Anxiolytics)
  ‚Ä¢ C6: N05C (Hypnotics)
  ‚Ä¢ C7: R03 (Airway Drugs)
  ‚Ä¢ C8: R06 (Antihistamines)
  
  üìä 342K+ weekly records
end note

note right of SHAP
  **NEW: Explainability**
  ‚Ä¢ SHAP values for tree models
  ‚Ä¢ Feature importance rankings
  ‚Ä¢ Waterfall plots
  ‚Ä¢ Summary visualizations
  ‚Ä¢ Trust & transparency
end note

note right of LLM
  **NEW: AI Explanations**
  ‚Ä¢ Llama 3.1 8B Instruct
  ‚Ä¢ QLoRA fine-tuning
  ‚Ä¢ Pharmaceutical context
  ‚Ä¢ Clinical recommendations
  ‚Ä¢ 400 training examples
end note

note bottom of API_FORE
  **Technology Stack**
  ‚Ä¢ Python 3.12 + Flask
  ‚Ä¢ PyTorch 2.9.1, TensorFlow 2.19
  ‚Ä¢ XGBoost 2.0, LightGBM 4.3
  ‚Ä¢ Transformers 4.57, SHAP 0.45
  ‚Ä¢ Chart.js, Plotly, D3.js
  ‚Ä¢ Ngrok tunneling
end note

note bottom of OUT
  **Performance Metrics**
  ‚Ä¢ 95.8% Forecast Accuracy
  ‚Ä¢ 2.4ms API Response
  ‚Ä¢ 8 AI Models Trained
  ‚Ä¢ SHAP Explainability
  ‚Ä¢ LLM Insights
  ‚Ä¢ Public URL Available
end note

note bottom of DEPLOY
  **Deployment Options**
  ‚Ä¢ üî• Ngrok (Instant)
  ‚Ä¢ ‚òÅÔ∏è Render.com (Free)
  ‚Ä¢ üöÇ Railway ($5 credit)
  ‚Ä¢ üê≥ Docker Ready
end note

legend right
  |= **System Capabilities** |
  | ‚úÖ 8 Forecasting Models |
  | ‚úÖ Meta-Learning (MAML) |
  | ‚úÖ NAS (Genetic Algorithm) |
  | ‚úÖ Federated Learning |
  | ‚úÖ Causal Inference |
  | ‚úÖ SHAP Explainability |
  | ‚úÖ LLM Explanations |
  | ‚úÖ Public URL Sharing |
  | ‚úÖ Real-time Predictions |
endlegend

@enduml
